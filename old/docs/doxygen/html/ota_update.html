<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DA16200 SDK: OTA (Over The Air) Update</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DA16200 SDK<span id="projectnumber">&#160;3.2.5.0</span>
   </div>
   <div id="projectbrief">Ultra-low power Wi-Fi SoC</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('ota_update.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">OTA (Over The Air) Update </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_md_files_md_ota_update"></a></p>
<h1><a class="anchor" id="autotoc_md25"></a>
Overview</h1>
<p >The DA16200 SDK supports OTA (over-the-air) FW(firmware) update with an Http(s) protocol in its library. Users can easily develop the OTA FW update function in the application. OTA FW update consists of Download and Renew functions. DOWNLOAD function is the process of downloading FW from server and is dependent on network status. The RENEW module refers to the process of replacing with a new FW after successful FW download. All the user should do is configure parameters and run a few APIs.</p>
<p ><img src="../image_files/OTA_FW_update_flow_chart.png" alt="ota_concept" class="inline"/> <br  />
</p>
<h1><a class="anchor" id="autotoc_md26"></a>
Features</h1>
<ul>
<li>The DA16200 supports HTTP/HTTPS 1.1. DA16200 requests firmware download to the HTTP-server by using the GET method of the HTTP-client.</li>
<li>The OTA update application must know the URL of the HTTP-server in advance before requesting a download.</li>
<li>When using HTTPS, the DA16200 must have at least 36 KB of heap memory for TLS encryption and decryption.</li>
<li>During the OTA update, the user must control not to enter DPM SLEEP.</li>
</ul>
<h1><a class="anchor" id="autotoc_md27"></a>
Firmware Version</h1>
<p ><img src="../image_files/OTA_FW_version_format.png" alt="ota_concept" class="inline"/> <br  />
 The Figure shows DA16200 header information as an example. Header information is 96 bytes and automatically inserted when firmware is built. Users do not need to understand all the contents of the header. The red box in Figure is the magic number and version information. The yellow box is information for checking firmware CRC. Users only need to understand the version information in the red box.</p>
<p >DA16200's RTOS has unique version rules for system protection. The version name is inserted as a 26-character string in the header part of the firmware image at the time of build. There are five elements in the version string, separated by "-". These are: Type, Vendor, Major, Minor, and Customer. Ex) FRTOS-GEN01-01-12345-000001</p>
<p ><em><b>Type-Vendor-Major-Minor-Customer</b></em></p><ul>
<li>Type (4 bytes): Identify the type of firmware.</li>
<li>Vendor (5 bytes): Vendor classification <br  />
</li>
<li>Major (2 bytes): Major number to check compatibility <br  />
</li>
<li>Minor (4~5 bytes): SDK patch number <br  />
</li>
<li>Customer (6 bytes): User configurable version <br  />
 Type-Vendor-Major determines whether DOWNLOAD or RENEW is compared to the version of firmware currently in operation. Minor-Customer can be used by the user for firmware version management. Users can change the customer version by editing ..<dl class="section version"><dt>Version</dt><dd>\3rd_customer_build_num.h. If users change the customer version and build the SDK, the customer version is applied to the image.</dd></dl>
</li>
<li>File location : <code>.\version\3rd_customer_build_num.h</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md28"></a>
Update type</h2>
<ul>
<li>OTA update task is operated based on the type defined in OTA update type. The operation sequence is tailored to the specified type. <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">ota_update_type   </th><th class="markdownTableHeadCenter">enum   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">OTA_TYPE_INIT   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyNone">Operation step of process.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OTA_TYPE_RTOS   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyNone">RTOS.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">OTA_TYPE_MCU_FW   </td><td class="markdownTableBodyCenter">2   </td><td class="markdownTableBodyNone">MCU firmware, not DA16x.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OTA_TYPE_CERT_KEY   </td><td class="markdownTableBodyCenter">3   </td><td class="markdownTableBodyNone">Certificate or Key.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">OTA_TYPE_UNKNOWN   </td><td class="markdownTableBodyCenter">4   </td><td class="markdownTableBodyNone">Unknown value.   </td></tr>
</table>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md29"></a>
Structure</h2>
<ul>
<li>OTA UPDATE CONFIG sets the necessary parameters when calling OTA FW update API. <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ota_update_type   </td><td class="markdownTableBodyNone">update_type   </td><td class="markdownTableBodyNone">Update type.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">char   </td><td class="markdownTableBodyNone">uri[HTTP_MAX_RESOURCE]   </td><td class="markdownTableBodyNone">Pointer variable to the server address where the RTOS exists.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">void   </td><td class="markdownTableBodyNone">(*download_notify)(ota_update_type update_type, UINT ret_status, UINT progress)   </td><td class="markdownTableBodyNone">Callback function pointer to check the download status.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">void   </td><td class="markdownTableBodyNone">(*renew_notify)(UINT ret_status)   </td><td class="markdownTableBodyNone">Callback function pointer to check the renew state. Only for RTOS.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">void   </td><td class="markdownTableBodyNone">(*renew_notify)(UINT ret_status)   </td><td class="markdownTableBodyNone">Callback function pointer to check the renew state.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">UINT   </td><td class="markdownTableBodyNone">auto_renew   </td><td class="markdownTableBodyNone">If the value is true, if the new firmware download is successful, it will reboot with the new firmware. Only for RTOS.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">UINT   </td><td class="markdownTableBodyNone">download_sflash_addr   </td><td class="markdownTableBodyNone">Address of sflash where other fw or certificate are stored. Only for MCU_FW and CERT_KEY.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">UINT   </td><td class="markdownTableBodyNone">download_sflash_addr   </td><td class="markdownTableBodyNone">Address of sflash where other_fw is stored. Only for MCU_FW and CERT_KEY.   </td></tr>
</table>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md30"></a>
Result Codes</h2>
<ul>
<li>All APIs, provided by OTA update return the result codes as shown in the Table. It is delivered through the callback function connected with DOWNLOAD and RENEW API. <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Result Code   </th><th class="markdownTableHeadCenter">Value   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>OTA_SUCCESS</code>   </td><td class="markdownTableBodyCenter"><code>0x00</code>   </td><td class="markdownTableBodyNone">Return success.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>OTA_FAILED</code>   </td><td class="markdownTableBodyCenter"><code>0x01</code>   </td><td class="markdownTableBodyNone">Return failed.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>OTA_ERROR_SFLASH_ADDR</code>   </td><td class="markdownTableBodyCenter"><code>0x02</code>   </td><td class="markdownTableBodyNone">Sflash address is wrong.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>OTA_ERROR_TYPE</code>   </td><td class="markdownTableBodyCenter"><code>0x03</code>   </td><td class="markdownTableBodyNone">FW type is unknown.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>OTA_ERROR_URL</code>   </td><td class="markdownTableBodyCenter"><code>0x04</code>   </td><td class="markdownTableBodyNone">Server URL is unknown.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>OTA_ERROR_SIZE</code>   </td><td class="markdownTableBodyCenter"><code>0x05</code>   </td><td class="markdownTableBodyNone">FW size is too big.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>OTA_ERROR_CRC</code>   </td><td class="markdownTableBodyCenter"><code>0x06</code>   </td><td class="markdownTableBodyNone">CRC is not correct.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>OTA_VERSION_UNKNOWN</code>   </td><td class="markdownTableBodyCenter"><code>0x07</code>   </td><td class="markdownTableBodyNone">FW version is unknown.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>OTA_VERSION_INCOMPATI</code>   </td><td class="markdownTableBodyCenter"><code>0x08</code>   </td><td class="markdownTableBodyNone">FW version is incompatible.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>OTA_NOT_FOUND</code>   </td><td class="markdownTableBodyCenter"><code>0x09</code>   </td><td class="markdownTableBodyNone">Fw not found on the server.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>OTA_NOT_CONNECTED</code>   </td><td class="markdownTableBodyCenter"><code>0x0A</code>   </td><td class="markdownTableBodyNone">Failed to connect to server.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>OTA_NOT_ALL_DOWNLOAD</code>   </td><td class="markdownTableBodyCenter"><code>0x0B</code>   </td><td class="markdownTableBodyNone">All new FWs have not been downloaded.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>OTA_MEM_ALLOC_FAILED</code>   </td><td class="markdownTableBodyCenter"><code>0x0C</code>   </td><td class="markdownTableBodyNone">Failed to alloc memory.   </td></tr>
</table>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md31"></a>
APIs</h1>
<ul>
<li>Start DOWNLOAD <blockquote class="doxtable">
<p >&zwj;<a class="el" href="ota__update_8h.html#a3a9796e9b6478c6b1d8718f79f7d1292">ota_update_start_download</a> <br  />
 </p>
</blockquote>
- Stop DOWNLOAD <br  />
 <blockquote class="doxtable">
<p >&zwj;<a class="el" href="ota__update_8h.html#a4e51f591171e9ce687d9a3801935defa">ota_update_stop_download</a> <br  />
 </p>
</blockquote>
- Start RENEW <blockquote class="doxtable">
<p >&zwj;<a class="el" href="ota__update_8h.html#ab94e4903354ddea768e3728ebeced1e3">ota_update_start_renew</a> <br  />
 </p>
</blockquote>
- Get Progress <blockquote class="doxtable">
<p >&zwj;ota_update_get_download_progress <br  />
 </p>
</blockquote>
- Get SFLASH Address of Download Area <blockquote class="doxtable">
<p >&zwj;<a class="el" href="ota__update_8h.html#a17c1bd6f059504b4b02cb330c9898576">ota_update_get_new_sflash_addr</a> </p>
</blockquote>
- Read SFLASH Data <blockquote class="doxtable">
<p >&zwj;<a class="el" href="ota__update_8h.html#a7fa4540e2c5fad827e9921370b8f584b">ota_update_read_flash</a> </p>
</blockquote>
- Erase SFLASH Data <blockquote class="doxtable">
<p >&zwj;<a class="el" href="ota__update_8h.html#a804d8e1a5ea4aa7f51cf17b1f866d457">ota_update_erase_flash</a> </p>
</blockquote>
- Copy SFLASH Data <blockquote class="doxtable">
<p >&zwj;<a class="el" href="ota__update_8h.html#a3ff6a028506a73c92a1a59e105a7d0c0">ota_update_copy_flash</a> </p>
</blockquote>
- Set MCU FW Name <blockquote class="doxtable">
<p >&zwj;<a class="el" href="ota__update_8h.html#a91ecd7a9f6c9413c75ac3cdeb19d928d">ota_update_set_mcu_fw_name</a> </p>
</blockquote>
- Get MCU FW Name <blockquote class="doxtable">
<p >&zwj;<a class="el" href="ota__update_8h.html#adbdababecad39ca30c33c58119379994">ota_update_get_mcu_fw_name</a> </p>
</blockquote>
- Get MCU FW Information <blockquote class="doxtable">
<p >&zwj;<a class="el" href="ota__update_8h.html#aaab0ccf2e619a3b3a259af1796df7da3">ota_update_get_mcu_fw_info</a> </p>
</blockquote>
- Read MCU FW (use UART) <blockquote class="doxtable">
<p >&zwj;<a class="el" href="ota__update_8h.html#a22e175d3c005659870bbc06672084520">ota_update_uart_read_mcu_fw</a> </p>
</blockquote>
- Transfer MCU FW (use UART) <blockquote class="doxtable">
<p >&zwj;<a class="el" href="ota__update_8h.html#aef0478b600367ca756d21dc612776cca">ota_update_uart_trans_mcu_fw</a> </p>
</blockquote>
- Erase MCU FW saved in sflash. <blockquote class="doxtable">
<p >&zwj;<a class="el" href="ota__update_8h.html#ac7fd3ef0389ac2a2ca0e433da6d73a1d">ota_update_erase_mcu_fw</a> </p>
</blockquote>
- Calculate CRC32 of MCU FW <blockquote class="doxtable">
<p >&zwj;<a class="el" href="ota__update_8h.html#ad33e71272bc18eda7cff61fc304e56d4">ota_update_calcu_mcu_fw_crc</a> </p>
</blockquote>
- UART initialization <blockquote class="doxtable">
<p >&zwj;<a class="el" href="ota__update_8h.html#a2074d3c3929c29296005b0189f0ff774">ota_update_uart_init</a> </p>
</blockquote>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="applications.html">Applications</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
